<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Patterns of dplyr operations</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Patterns of dplyr operations</h1>



<p>The main design goal of dplyr is to be intuitive. Ideally, it should be obvious from a glance what a piece of dplyr is about, and what it does. But despite this apparent simplicitly, many different things happen under the hood. This vignette explains how each dplyr verb behaves to help you become more proficient in writing R and tidyverse code.</p>
<p>The dplyr verbs can be categorised along three main properties:</p>
<ul>
<li><p>How they reshape the data frame. Many verbs may create columns, other can remove columns. Some shrink the number of rows, others make it longer. Quite often, the shape does not change.</p></li>
<li><p>The type of data passed in by the user. Is the data created on the spot by computing new columns or is the data purely selected within the data frame? In the former case, the verb takes <strong>actions</strong>, in the latter case, it takes <strong>selections</strong>.</p></li>
<li><p>How the verb handle groups. Most of the time, grouped data frames produce different results than ungrouped data frames because the computations occur within group levels.</p></li>
</ul>
<div id="sec:actions-selections" class="section level2">
<h2>Actions and selections</h2>
<p>Actions and selections are two kinds of operations in dplyr and the tidyverse. We call <strong>operations</strong> the arguments supplied by the user that either create new columns or vectors, or select them from a data frame. An operation may be very simple. For instance, the following examples feature two operations <code>eye_color</code> and <code>hair_color</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(mass, hair_color)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; # A tibble: 87 x 13</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt;   name  height  mass hair_color skin_color eye_color birth_year gender</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 1 Ratt…     79    15 none       grey, blue unknown           NA male  </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 2 Yoda      66    17 white      green      brown            896 male  </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 3 Wick…     88    20 brown      brown      brown              8 male  </span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 4 R2-D2     96    32 &lt;NA&gt;       white, bl… red               33 &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; # … with 83 more rows, and 5 more variables: homeworld &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mass, hair_color)</a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; # A tibble: 87 x 2</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt;    mass hair_color</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; 1    77 blond     </span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#&gt; 2    75 &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt; 3    32 &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co">#&gt; 4   136 none      </span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>But really, the operations can become as complex as you like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>mass, <span class="kw">desc</span>(<span class="kw">paste</span>(hair_color, eye_color)))</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; # A tibble: 87 x 13</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&gt;   name  height  mass hair_color skin_color eye_color birth_year gender</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; 1 Jabb…    175  1358 &lt;NA&gt;       green-tan… orange         600   herma…</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; 2 Grie…    216   159 none       brown, wh… green, y…       NA   male  </span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; 3 IG-88    200   140 none       metal      red             15   none  </span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; 4 Dart…    202   136 none       white      yellow          41.9 male  </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; # … with 83 more rows, and 5 more variables: homeworld &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="kw">intersect</span>(<span class="kw">starts_with</span>(<span class="st">&quot;hair&quot;</span>), <span class="kw">ends_with</span>(<span class="st">&quot;color&quot;</span>)))</a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt; # A tibble: 87 x 2</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt;    mass hair_color</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt; 1    77 blond     </span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt; 2    75 &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#&gt; 3    32 &lt;NA&gt;      </span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">#&gt; 4   136 none      </span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>While all operations look like R code, they are actually interpreted a little differently, depending on the dplyr verb at the receiving end. The key too be effective at writing more complex dplyr operations is to understand the difference between two kinds of operations, actions and selections.</p>
<div id="actions" class="section level3">
<h3>Actions</h3>
<p>Actions are the most common flavour of dplyr operations. They behave just like any ordinary R code, with a few added features.</p>
<div id="data-creation" class="section level4">
<h4>Data creation</h4>
<p>All actions create new data. To illustrate this, we use <code>transmute()</code>, a dplyr verb that takes actions and returns the result of those actions, preserving the shape of the data frame:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt;   `1 + 2`</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">#&gt; 1       3</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt; 2       3</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt; 3       3</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">#&gt; 4       3</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>We get a one-column data frame containing the result of <code>1 + 2</code>, recycled to the total data frame size, and given an automatic name to remind how the data was created.</p>
</div>
<div id="data-masking" class="section level4">
<h4>Data masking</h4>
<p>Actions are computed in the context of your data frame. This means you can refer to your columns as if they were actual objects in your workspace. We call this <strong>data masking</strong> because the columns have precedence over other objects in your workspace, i.e. they mask these objects.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">height &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co"># In the workspace, we can safely refer to workspace objects:</span></a>
<a class="sourceLine" id="cb4-4" title="4">height <span class="op">/</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt; [1] 5</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># In the data mask, they are masked by the data:</span></a>
<a class="sourceLine" id="cb4-8" title="8">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(height <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt;   `height/100`</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; 1         1.72</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; 2         1.67</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; 3         0.96</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; 4         2.02</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
</div>
<div id="grouping" class="section level4">
<h4>Grouping</h4>
<p>When you supply a grouped tibble, actions are automatically computed within groups. This is a dplyr feature that isn’t available in all data-masking APIs, for instance actions supplied to <code>ggplot2::aes()</code> are not computed within groups.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Standardising by the population standard deviation</span></a>
<a class="sourceLine" id="cb5-2" title="2">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dt">height =</span> height <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt;   height</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; 1   4.95</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; 2   4.80</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; 3   2.76</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; 4   5.81</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; # … with 83 more rows</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co"># Standardising by within-group standard deviations</span></a>
<a class="sourceLine" id="cb5-13" title="13">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(eye_color) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dt">height =</span> height <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; # A tibble: 87 x 2</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; # Groups:   eye_color [15]</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt;   eye_color height</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt; 1 blue        8.46</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt; 2 yellow      3.96</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt; 3 red         1.80</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt; 4 yellow      4.78</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
</div>
</div>
<div id="selections" class="section level3">
<h3>Selections</h3>
<p>The usage of <code>dplyr::select()</code> looks similar to other verbs. In some cases, you’ll get exactly the same results:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(height)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt;   height</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; 1    172</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; 2    167</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; 3     96</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; 4    202</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; # … with 83 more rows</span></a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(height)</a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt;   height</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; 1    172</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; 2    167</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt; 3     96</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt; 4    202</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>However <code>select()</code> actually uses a different mechanism under the hood. The arguments to <code>select()</code> are <em>selections</em>, not actions. Whereas action verbs take entire vectors as arguments, selecting verbs take column names or column positions. Observe the difference:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt;   height</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; 1    172</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; 2    167</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; 3     96</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; 4    202</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; # … with 83 more rows</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; # A tibble: 87 x 1</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;     `2`</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; 1     2</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; 2     2</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; 3     2</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; 4     2</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>The key feature of selecting verbs is that column names represent their own <em>position</em> inside the data frame. From the persective of <code>select()</code>, <code>height</code> is the same as <code>2</code> because it is the second column in the <code>starwars</code> data frame. On the other hand, <code>transmute()</code> takes actions and interprets <code>2</code> as a new column recycled to the full data frame size.</p>
<p>There are two reasons for this difference.</p>
<ol style="list-style-type: decimal">
<li><p>It makes it possible to select ranges of columns with <code>start:end</code>. For instance, <code>name:mass</code> expands to <code>1:3</code>. This couldn’t work if <code>name</code> and <code>mass</code> represented the entire columns rather than just their positions.</p></li>
<li><p>It allows overlapping selections. Take the sets of columns starting with the letter <code>&quot;h&quot;</code> and of columns ending with the suffix <code>&quot;_color&quot;</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;h&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt; [1] &quot;height&quot;     &quot;hair_color&quot; &quot;homeworld&quot;</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_color&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt; [1] &quot;hair_color&quot; &quot;skin_color&quot; &quot;eye_color&quot;</span></a></code></pre></div>
<p>It is easy to select the union of those overlapping sets:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;h&quot;</span>), <span class="kw">ends_with</span>(<span class="st">&quot;_color&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()</a></code></pre></div>
<p>To achieve this, <code>select()</code> needs unique identifiers for the columns, which the column positions provide.</p></li>
</ol>
<div id="data-expressions-versus-context-expressions" class="section level4">
<h4>Data expressions versus context expressions</h4>
</div>
</div>
<div id="the-origins-of-actions-and-selections" class="section level3">
<h3>The origins of actions and selections</h3>
<div id="data-masking-1" class="section level4">
<h4>Data masking</h4>
<p>Actions are operations evaluated with a data mask. The notion of actions is embedded deep in the R language:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">result &lt;-<span class="st"> </span><span class="kw">with</span>(starwars, mass <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">head</span>(result)</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt; [1] 0.77 0.75 0.32 1.36 0.49 1.20</span></a></code></pre></div>
<p>The low-level function <code>eval()</code> makes it easy to implement actions:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">expr &lt;-<span class="st"> </span><span class="kw">quote</span>(mass <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb11-2" title="2">result &lt;-<span class="st"> </span><span class="kw">eval</span>(expr, starwars)</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">head</span>(result)</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; [1] 0.77 0.75 0.32 1.36 0.49 1.20</span></a></code></pre></div>
<p>Tidyverse packages use tidy eval, an extension of base R data masking provided by the <a href="https://rlang.r-lib.org/">rlang</a> package.</p>
</div>
<div id="the-select-argument" class="section level4">
<h4>The <code>select</code> argument</h4>
<p>Selections were introduced in base R with the <code>select</code> argument of <code>base::subset()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">subset</span>(starwars, <span class="dt">select =</span> name<span class="op">:</span>mass)</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; # A tibble: 87 x 3</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt;   name           height  mass</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt;   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; 1 Luke Skywalker    172    77</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; 2 C-3PO             167    75</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; 3 R2-D2              96    32</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; 4 Darth Vader       202   136</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; # … with 83 more rows</span></a></code></pre></div>
<p>Selections are implemented with a special data mask that contains column positions:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">mask &lt;-<span class="st"> </span><span class="kw">as.list</span>(<span class="kw">seq_along</span>(starwars))</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">names</span>(mask) &lt;-<span class="st"> </span><span class="kw">names</span>(starwars)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">str</span>(mask)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt; List of 13</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt;  $ name      : int 1</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt;  $ height    : int 2</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt;  $ mass      : int 3</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt;  $ hair_color: int 4</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt;  $ skin_color: int 5</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt;  $ eye_color : int 6</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;  $ birth_year: int 7</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt;  $ gender    : int 8</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt;  $ homeworld : int 9</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt;  $ species   : int 10</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt;  $ films     : int 11</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt;  $ vehicles  : int 12</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="co">#&gt;  $ starships : int 13</span></a></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
