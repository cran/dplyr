<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Applying operations over different columns</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Applying operations over different columns</h1>



<p>With <code>group_by()</code>, dplyr makes it easy to apply operations over different groups of rows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;   gender        `mean(height, na.rm = TRUE)`</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;                                &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; 1 &lt;NA&gt;                                  120 </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; 2 female                                165.</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; 3 hermaphrodite                         175 </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; 4 male                                  179.</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; # … with 1 more row</span></a></code></pre></div>
<p>Sometimes it is also useful to apply the same operation over different columns. We need a different approach in that case, we need to <strong>apply</strong>, or <strong>map</strong> functions over the columns. This requires a little more programming knowledge because you need to wrap your operation in a function and pass that function to dplyr verbs. However, this knowledge is widely reusable in base R (apply family) and the tidyverse (map family). To brush up on the notion of iteration with functions, read the <a href="https://r4ds.had.co.nz/iteration.html">iteration</a> chapter of the online book R4DS.</p>
<p>dplyr provides variants of the main data manipulation verbs that map functions over a selection of columns. These verbs are known as the <a href="https://dplyr.tidyverse.org/reference/scoped.html">scoped variants</a> and are recognizable from their <code>_at</code>, <code>_if</code> and <code>_all</code> suffixes.</p>
<div id="selecting-columns" class="section level2">
<h2>Selecting columns</h2>
<p>Scoped verbs support three sorts of selection:</p>
<ol style="list-style-type: decimal">
<li><p><code>_all</code> verbs operate on all columns of the data frame. You can summarise all columns of a data frame within groups with <code>summarise_all()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(mean)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;   Species    Sepal.Length Sepal.Width Petal.Length Petal.Width</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; 1 setosa             5.01        3.43         1.46       0.246</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; 2 versicolor         5.94        2.77         4.26       1.33 </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; 3 virginica          6.59        2.97         5.55       2.03</span></a></code></pre></div></li>
<li><p><code>_if</code> verbs operate conditionally, on all columns for which a predicate returns <code>TRUE</code>. If you are familiar with purrr, the idea is similar to the conditional mapper <code>purrr::map_if()</code>. Promoting all character columns of a data frame as grouping variables is as simple as:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by_if</span>(is.character)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; # A tibble: 87 x 13</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; # Groups:   name, hair_color, skin_color, eye_color, gender, homeworld,</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; #   species [87]</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;   name  height  mass hair_color skin_color eye_color birth_year gender</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; 1 Luke…    172    77 blond      fair       blue            19   male  </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 4 Dart…    202   136 none       white      yellow          41.9 male  </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; # … with 83 more rows, and 5 more variables: homeworld &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></a></code></pre></div></li>
<li><p><code>_at</code> verbs operate on a selection of columns. You can supply integer vectors of column positions or character vectors of colunm names.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_at</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, mean)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;        mpg    cyl</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; 1 20.09062 6.1875</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_at</span>(<span class="kw">c</span>(<span class="st">&quot;disp&quot;</span>, <span class="st">&quot;drat&quot;</span>), median)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;    disp  drat</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 1 196.3 3.695</span></a></code></pre></div>
<p>More interestingly, you can use <code>vars()</code>[^fn:vars] to supply the same sort of expressions you would pass to <code>select()</code>! The selection helpers make it very convenient to craft a selection of columns to map over.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(height<span class="op">:</span>mass), mean)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;   height  mass</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1     NA    NA</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_color&quot;</span>)), n_distinct)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;   hair_color skin_color eye_color</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;        &lt;int&gt;      &lt;int&gt;     &lt;int&gt;</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 1         13         31        15</span></a></code></pre></div></li>
</ol>
<p>The scoped variants of <code>mutate()</code> and <code>summarise()</code> are the closest analogue to <code>base::lapply()</code> and <code>purrr::map()</code>. Unlike pure list mappers, the scoped verbs fully implement the dplyr semantics, such as groupwise vectorisation or the summary constraints:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># map() returns a simple list with the results</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(mean)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; $mpg</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; [1] 20.09062</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; $cyl</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; [1] 6.1875</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; $disp</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; [1] 230.7219</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; $hp</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; [1] 146.6875</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; $drat</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; [1] 3.596563</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co"># `mutate_` variants recycle to group size</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_all</span>(mean)</a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; # A tibble: 32 x 5</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt;     mpg   cyl  disp    hp  drat</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; 1  20.1  6.19  231.  147.  3.60</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="co">#&gt; 2  20.1  6.19  231.  147.  3.60</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#&gt; 3  20.1  6.19  231.  147.  3.60</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt; 4  20.1  6.19  231.  147.  3.60</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co">#&gt; # … with 28 more rows</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co"># `summarise_` variants enforce a size 1 constraint</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30">mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(mean)</a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt; # A tibble: 1 x 5</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="co">#&gt;     mpg   cyl  disp    hp  drat</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="co">#&gt; 1  20.1  6.19  231.  147.  3.60</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co"># All scoped verbs know about groups</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37">mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(mean)</a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">#&gt;     cyl   mpg  disp    hp  drat</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="co">#&gt; 1     4  26.7  105.  82.6  4.07</span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42"><span class="co">#&gt; 2     6  19.7  183. 122.   3.59</span></a>
<a class="sourceLine" id="cb6-43" data-line-number="43"><span class="co">#&gt; 3     8  15.1  353. 209.   3.23</span></a></code></pre></div>
<p>The other scoped variants also accept optional functions to map over the selection of columns. For instance, you could group by a selection of variables and transform them on the fly:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by_if</span>(is.factor, as.character)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A tibble: 150 x 5</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; # Groups:   Species [3]</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2 setosa </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; 2          4.9         3            1.4         0.2 setosa </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2 setosa </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; 4          4.6         3.1          1.5         0.2 setosa </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; # … with 146 more rows</span></a></code></pre></div>
<p>or transform the column names of selected variables:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">storms <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_at</span>(<span class="kw">vars</span>(name<span class="op">:</span>hour), toupper)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; # A tibble: 10,010 x 5</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;   NAME   YEAR MONTH   DAY  HOUR</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; 1 Amy    1975     6    27     0</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; 2 Amy    1975     6    27     6</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; 3 Amy    1975     6    27    12</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; 4 Amy    1975     6    27    18</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; # … with 10,006 more rows</span></a></code></pre></div>
<p>The scoped variants lie at the intersection of purrr and dplyr and combine the rowwise looping mechanisms of dplyr with the columnwise mapping of purrr. This is a powerful combination.</p>
</div>
<div id="transitioning-from-funs-to-purrr-style-formulas" class="section level2">
<h2>Transitioning from <code>funs()</code> to purrr-style formulas</h2>
<p>Historically, mapping functions has been done through a special syntax that was unique to dplyr. The <code>funs()</code> helper would take quoted expression in which <code>.</code> represented the function input. In order to make the tidyverse more consistent and to reduce the variety of syntax to learn, we have deprecated this idiosyncratic interface in favour of purrr-style formulas and ordinary functions.</p>
<p>The purrr syntax makes it convenient to define functions on the fly:</p>
<pre><code>library(&quot;purrr&quot;)

# Mapping an ordinary function:
map_dbl(mtcars, function(input) mean(input, na.rm = TRUE))

# Mapping with the formula syntax:
map_dbl(mtcars, ~ mean(., na.rm = TRUE))</code></pre>
<p>Like <code>funs()</code>, formulas create functions where <code>.</code> represents the input. Another pronoun for the input is <code>.x</code>. It is especially useful for mapping two arguments at the same time because the second one can be referred by <code>.y</code>. The scoped verbs in dplyr only support mapping one input so it is fine to keep using the <code>.</code> pronoun.</p>
<p>Changing your code to use purrr lambdas should be straightforward in most cases.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="ot">NA</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [1] NA</span></a></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
